/*
 * Task_Scheduler.c
 *
 *  Created on: Apr 3, 2023
 *      Author: uif47623
*/

/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/

#include "Task_Scheduler.h"
#include <Time.h>

/*********************************************************************************************************************/
/*------------------------------------------------------Defines------------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------------Structs------------------------------------------------------*/
/*********************************************************************************************************************/

/*********************************************************************************************************************/
/*------------------------------------------------------Globals------------------------------------------------------*/
/*********************************************************************************************************************/
// Array with all tasks
S_TS_Task taskList[MAX_TASKS];

// Global var that stores the number of tasks
uint16 numOfTasks = 0;

/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/

void TS_Create_Task(void (*function)(void), unsigned long interval) {
    if (numOfTasks >= MAX_TASKS) {
        // ERROR: too many tasks!
    }

    S_TS_Task newTask = { function, interval, interval };
    taskList[numOfTasks++] = newTask;
}

void TS_Main() {
    uint32 currentTime = time(NULL);

    for (uint8 index = 0; index < numOfTasks; index++) {
        if (currentTime >= taskList[index].nextExecTime) {
            taskList[index].function();
            taskList[index].nextExecTime = currentTime + taskList[index].interval;
        }
    }
}


