/*
 * Can_Drv.c
 *
 *  Created on: May 19, 2023
 *      Author: uif47623
 */
/*********************************************************************************************************************/
/*-----------------------------------------------------Includes------------------------------------------------------*/
/*********************************************************************************************************************/
#include "Can_Drv.h"
/*********************************************************************************************************************/
/*-------------------------------------------------Global variables--------------------------------------------------*/
/*********************************************************************************************************************/
McmCanType McmCan;
/*********************************************************************************************************************/
/*---------------------------------------------Function Implementations----------------------------------------------*/
/*********************************************************************************************************************/
IFX_INTERRUPT(canIsrTxHandler, 0, ISR_PRIORITY_CAN_TX);
IFX_INTERRUPT(canIsrRxHandler, 0, ISR_PRIORITY_CAN_RX);

void Can_Drv_v_InitCan() {
    // load default CAN module config into config struct
    IfxCan_Can_initModuleConfig(&McmCan.canConfig, &MODULE_CAN0);
    // init CAN module with default config
    IfxCan_Can_initModule(&McmCan.canModule, &McmCan.canConfig);


    // load default config in config struct
    IfxCan_Can_initNodeConfig(&McmCan.canNodeConfig, &McmCan.canModule);
    McmCan.canNodeConfig.nodeId = IfxCan_NodeId_0;
    McmCan.canNodeConfig.frame.type = IfxCan_FrameType_transmit;
    // set tx mode to dedicated buffers
    McmCan.canNodeConfig.txConfig.txMode = 2;

    McmCan.canNodeConfig.interruptConfig.transmissionCompletedEnabled = TRUE;
    McmCan.canNodeConfig.interruptConfig.traco.priority = 2; // ISR_PRIORITY_CAN_TX
    McmCan.canNodeConfig.interruptConfig.traco.interruptLine = IfxCan_InterruptLine_0;
    McmCan.canNodeConfig.interruptConfig.traco.typeOfService = IfxSrc_Tos_cpu0;

    IfxCan_Can_initNode(&McmCan.canSrcNode, &McmCan.canNodeConfig);


    // CONFIG Destination CAN node


    IfxCan_Can_initNodeConfig(&McmCan.canNodeConfig, &McmCan.canModule);

    McmCan.canNodeConfig.nodeId = IfxCan_NodeId_1;
    McmCan.canNodeConfig.frame.type = IfxCan_FrameType_receive;

    IfxCan_Can_Pins *receivePins;
    receivePins->rxPin = &MODULE_P00, 1;//IfxCan_RXD10A_P00_1_IN;

    McmCan.canNodeConfig.pins = receivePins;

    McmCan.canNodeConfig.interruptConfig.messageStoredToDedicatedRxBufferEnabled = TRUE;
    McmCan.canNodeConfig.interruptConfig.reint.priority = 1; //ISR_PRIORITY_CAN_RX;
    McmCan.canNodeConfig.interruptConfig.reint.interruptLine = IfxCan_InterruptLine_1;
    McmCan.canNodeConfig.interruptConfig.reint.typeOfService = IfxSrc_Tos_cpu0;

    IfxCan_Can_initNode(&McmCan.canDstNode, &McmCan.canNodeConfig);

}

void Can_Drv_v_TransmitCanMessage(void) {

}

void canIsrRxHandler(void)
{

}

void canIsrTxHandler(void)
{

}
